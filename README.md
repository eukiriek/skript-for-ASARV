# Условие 1: если отработанное время >= 24 часов, просто копируем
mask_ge_24 = df["Отработанное время"] >= pd.Timedelta(hours=24)
df.loc[mask_ge_24, "Новое отработанное время"] = df.loc[mask_ge_24, "Отработанное время"]

# Условие 2: для остальных считаем по новому правилу
mask_other = ~mask_ge_24

# Базовое новое отработанное время = выход - вход
raw_work = df["Время выхода"] - df["Время входа"]

# Сначала просто записываем базовое значение
df.loc[mask_other, "Новое отработанное время"] = raw_work[mask_other]

# Там, где отработанное время > 5 часов — дополнительно вычитаем max(обед, отсутствие)
mask_long = mask_other & (raw_work > pd.Timedelta(hours=5))
max_break = df[["Время обеда", "Время отсутствия"]].max(axis=1)

df.loc[mask_long, "Новое отработанное время"] = (
    raw_work[mask_long] - max_break[mask_long]
)












Ch
