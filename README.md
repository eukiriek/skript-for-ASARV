import pandas as pd
import numpy as np

# предполагаем, что у вас уже есть df с колонками:
# 'Имя', 'Вид события', 'Время', 'Дата'

# 1. Приводим дату/время к удобному формату
df['Дата'] = pd.to_datetime(df['Дата'], dayfirst=True)          # дд.мм.гггг
df['dt'] = pd.to_datetime(
    df['Дата'].dt.strftime('%Y-%m-%d') + ' ' + df['Время'].astype(str)
)

# 2. Сортируем события по сотруднику, дате и времени
df = df.sort_values(['Имя', 'Дата', 'dt'])

# 3. Берём предыдущее событие внутри сотрудника и даты
df['prev_dt'] = df.groupby(['Имя', 'Дата'])['dt'].shift(1)
df['prev_event'] = df.groupby(['Имя', 'Дата'])['Вид события'].shift(1)

# 4. Считаем разницу только для строк "уход" после "приход"
mask = (df['Вид события'] == 'уход') & (df['prev_event'] == 'приход')

df['Длительность_между_приходом_и_уходом'] = pd.NaT
df.loc[mask, 'Длительность_между_приходом_и_уходом'] = (
    df.loc[mask, 'dt'] - df.loc[mask, 'prev_dt']
)

# если нужно в минутах:
# df['Длительность_минуты'] = df['Длительность_между_приходом_и_уходом'].dt.total_seconds() / 60
